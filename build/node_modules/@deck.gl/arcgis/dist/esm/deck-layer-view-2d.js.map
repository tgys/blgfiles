{"version":3,"sources":["../../src/deck-layer-view-2d.js"],"names":["initializeResources","render","finalizeResources","createDeckLayerView2D","BaseLayerViewGL2D","createSubclass","properties","deckgl","deckFbo","model","buffer","attach","gl","context","call","layer","deck","on","props","deckInstance","setProps","toJSON","redraw","requestRender","detach","renderParameters","view","state","size","width","height","viewState","latitude","center","longitude","zoom","featuresTilingScheme","scaleToLevel","scale","bearing","rotation","pitch"],"mappings":";AAAA,SAAQA,mBAAR,EAA6BC,MAAM,IAANA,OAA7B,EAAqCC,iBAArC,QAA6D,WAA7D;AAEA,eAAe,SAASC,qBAAT,CAA+BC,iBAA/B,EAAkD;AAC/D,SAAOA,iBAAiB,CAACC,cAAlB,CAAiC;AACtCC,IAAAA,UAAU,EAAE;AACVC,MAAAA,MAAM,EAAE,EADE;AAEVC,MAAAA,OAAO,EAAE,EAFC;AAGVC,MAAAA,KAAK,EAAE,EAHG;AAIVC,MAAAA,MAAM,EAAE;AAJE,KAD0B;AAStCC,IAAAA,MATsC,oBAS7B;AAAA;;AAGP,UAAMC,EAAE,GAAG,KAAKC,OAAhB;AACAb,MAAAA,mBAAmB,CAACc,IAApB,CAAyB,IAAzB,EAA+BF,EAA/B;AAGA,WAAKG,KAAL,CAAWC,IAAX,CAAgBC,EAAhB,CAAmB,QAAnB,EAA6B,UAAAC,KAAK;AAAA,eAAI,KAAI,CAACC,YAAL,CAAkBC,QAAlB,CAA2BF,KAA3B,CAAJ;AAAA,OAAlC;AAGA,WAAKC,YAAL,CAAkBC,QAAlB,CAA2B,KAAKL,KAAL,CAAWC,IAAX,CAAgBK,MAAhB,EAA3B;AACD,KApBqC;AAsBtCC,IAAAA,MAtBsC,oBAsB7B;AACP,WAAKC,aAAL;AACD,KAxBqC;AA2BtCC,IAAAA,MA3BsC,oBA2B7B;AACPtB,MAAAA,iBAAiB,CAACY,IAAlB,CAAuB,IAAvB;AACD,KA7BqC;AAgCtCb,IAAAA,MAhCsC,kBAgC/BwB,gBAhC+B,EAgCb;AAAA,iDACC,KAAKC,IAAL,CAAUC,KAAV,CAAgBC,IADjB;AAAA,UAChBC,KADgB;AAAA,UACTC,MADS;;AAGvB,UAAMH,KAAK,GAAGF,gBAAgB,CAACE,KAA/B;;AAEA1B,MAAAA,OAAM,CAACa,IAAP,CAAY,IAAZ,EAAkB;AAChBF,QAAAA,EAAE,EAAEa,gBAAgB,CAACZ,OADL;AAEhBgB,QAAAA,KAAK,EAALA,KAFgB;AAGhBC,QAAAA,MAAM,EAANA,MAHgB;AAIhBC,QAAAA,SAAS,EAAE;AACTC,UAAAA,QAAQ,EAAE,KAAKN,IAAL,CAAUO,MAAV,CAAiBD,QADlB;AAETE,UAAAA,SAAS,EAAE,KAAKR,IAAL,CAAUO,MAAV,CAAiBC,SAFnB;AAGTC,UAAAA,IAAI,EAAE,KAAKT,IAAL,CAAUU,oBAAV,CAA+BC,YAA/B,CAA4CV,KAAK,CAACW,KAAlD,CAHG;AAITC,UAAAA,OAAO,EAAE,CAACZ,KAAK,CAACa,QAJP;AAKTC,UAAAA,KAAK,EAAE;AALE;AAJK,OAAlB;AAYD;AAjDqC,GAAjC,CAAP;AAmDD","sourcesContent":["import {initializeResources, render, finalizeResources} from './commons';\n\nexport default function createDeckLayerView2D(BaseLayerViewGL2D) {\n  return BaseLayerViewGL2D.createSubclass({\n    properties: {\n      deckgl: {},\n      deckFbo: {},\n      model: {},\n      buffer: {}\n    },\n\n    // Attach is called as soon as the layer view is ready to start rendering.\n    attach() {\n      // We use a full-screen quad and shaders to composite the frame rendered\n      // with deck.gl on top of the MapView. Composition uses the MapView context.\n      const gl = this.context;\n      initializeResources.call(this, gl);\n\n      // Update deck props\n      this.layer.deck.on('change', props => this.deckInstance.setProps(props));\n\n      // We need to start drawing the deck.gl layer immediately.\n      this.deckInstance.setProps(this.layer.deck.toJSON());\n    },\n\n    redraw() {\n      this.requestRender();\n    },\n\n    // Called when the layer must be destroyed.\n    detach() {\n      finalizeResources.call(this);\n    },\n\n    // Called every time that the layer view must be rendered.\n    render(renderParameters) {\n      const [width, height] = this.view.state.size;\n      // The view state must be kept in-sync with the MapView of the ArcGIS API.\n      const state = renderParameters.state;\n\n      render.call(this, {\n        gl: renderParameters.context,\n        width,\n        height,\n        viewState: {\n          latitude: this.view.center.latitude,\n          longitude: this.view.center.longitude,\n          zoom: this.view.featuresTilingScheme.scaleToLevel(state.scale),\n          bearing: -state.rotation,\n          pitch: 0\n        }\n      });\n    }\n  });\n}\n"],"file":"deck-layer-view-2d.js"}